今天下午接近三点的时候接到面试电话。

---

面试官很客气，体验很好，5星好评，明年再来(哭丧脸)。先一问一答，然后再集中解释。

开头先问了synchronized和Lock的区别：然后说了下 synchronized基本就是Lock的内置版本

然后任意初始化一个对象，我们该怎么估计该对象的内存占用大小：这要看该对象它的实力域中包含的对象和数据情况，假如只包含了一个int变量，那大约就是32个字节，而如果包含其他对象，则是该对象的引用大小加上数据大小...

假如包含其他对象实例的空间也算到一起呢，怎么计算：就把它包含的对象大小加上它的大小。。。

**那么如何使用代码来计算该对象的大小，包含引用对象的大小：** 当时面试官问的时候我满脸都是迷茫，支支吾吾了好久，然后只能说不知道了。

换个方向，假设有**1千万个数字在一个文件内**(数字不重复，且都小于2千万，换行隔开)，怎么尽快又省内存的把他按照从小到大的转移到另一个文件内，执行的IO操作是多少次：脑子一片空白，回答了归并加上数据分段处理，至于IO多少次，我就呵呵了。。。 没事，回去查些资料就好了。

对Java这块还有比较熟悉的模块吗？比如网络安全方面：我对集合类和多线程比较熟悉。

集合类库中有多少是线程安全的类呢？：ConcurrentHashMap，Vector，SynchronizedList，，，，

ArrayList和LinkedList随机读取的时间复杂度：O(1) 和 O(n) 。

那么查找呢？假设要判断数据是否在ArrayList或者LinkedList中：ArrayList是数组存储的，可以在有序的时候采用二分查找，至于链表恐怕只能迭代，如果把数据进行预处理放到HashSet中就可以利用hash查找。

说到hash查找，它的逻辑是什么呢：简单来说就是利用hashCode算法对该对象给出一个整数值，然后对整个HashSet的大小取模出来的值，就是它的存储位置。如果发生冲突，就采用拉链法。

HashMap或者HashSet的key是不可以重复的，那它们是如何判断一个对象是否是重复的呢？：它们里面有一个equals方法，用于判断对象是否一致。可以先用equals判断然后再计算hashcode插入：

你这两个顺序反了吧，先equals的话比较慢吧。因为两个对象的hashcode如果不一样的话，那么它们两个肯定不是一个一样的对象，：哦哦，有道理，有道理。

简述一下乐观锁和悲观锁吧：悲观锁就是synchronized这样的，认为一个资源在一段时间内一定会发生冲突，所以就把资源独占——锁了起来：而乐观锁就是认为该资源在一段时间内不会发生冲突，不加锁去获取资源，如果发生冲突就重新来过

有什么常见的乐观锁吗？：CAS，CompareAndSwap()就是比较经典的乐观锁。

假设有10个线程，对象里面只有一个变量`int i`，分别对它进行i++，最后的结果是什么呢？：因为i++这个操作是分为三个步骤，获取i的值，修改i的值，写入i的值。所以它不是原子操作，即不是线程安全的。所以线程的执行顺序和交替次序未知，最后的结果是一个小于10的数。

知道volatile吗？：它表示的是内存可见性，假设上一个例子中的i变量加上了volatile，那么它在高速缓存和寄存器中的值是不可用的，每个线程想要访问i，只能从内存获取它的值。

怎么获取一个单例：可以把它的构造函数设为 `private Gouzao(){}`，然后`synchronized getInstance()`获取实例

怎么延迟获取对象：这里我蒙了一下，上面说的不就是延迟获取的方法吗，可能这里我们两个的理解或者没听清吧。除了上面那个方法，我没想出来怎么延迟获取对象，，他说：没关系，没接触过这方面一下子想不到很正常的。

---

先重点说解析一下面试中没有思路的问题：

如何使用代码得知对象大小(包含引用对象的内存空间)：[聊聊JVM（三）两种计算Java对象大小的方法](https://blog.csdn.net/iter_zc/article/details/41822719) 

[多路归并 外排序 大文件排序 海量数据处理](https://blog.csdn.net/longzuo/article/details/46409249)：看了下文章，发现我之前想到的分段归并总体思路是正确的，但是我是分段用归并排序，而这边是：

首先将1千万个数据分成n批，然后分别进行排序。n组排好序之后输入到文件中形成n个文件，

再生成一个长度为n的数组分别指向n个文件的指针，分别顺序读取各个文件的数据 如 n1读取第一个文件的第1个元素，n2读取第二个文件的第一个元素...，然后选择其中最小的数字写入新文件。被选择的那个数的指针往文件下一位移动，

然后再读取各个指针下的数据，，如此反复直到所有文件读完。

[面试官眼中的单例](https://juejin.im/post/5b50b0dd6fb9a04f932ff53f)

