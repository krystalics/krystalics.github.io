*《高性能MySQL》第三版*

---

### 第二章：Mysql基准测试

​	基准测试(benchmark)是MySQL新手和专家都需要掌握的一项基本技能。简单地说，基准测试是针对系统设计的一种压力测试。通常的目标是为了掌握系统的行为。但也有其他原因，如重现某个系统状态，或者是做新硬件的可靠性测试。本章将讨论MySQL和基于MySQL的基准测试的重要性，策略和工具。我们将特别讨论一下sysbench，一款非常优秀的MySQL基准测试工具。

#### 2.1 为什么需要基准测试

​	因为基准测试时唯一方便有效的，可以学习系统在给定的工作负载下会发生什么的方法。基准测试可以观察系统在不同压力下的行为，评估系统的容量，掌握哪些是重要的变化，或者观察如何处理不同的数据。基准测试可以在系统实际负载之外创造一些虚构场景进行测试。基准测试可以完成很多工作，如下一些例子：

1. **验证基于系统的一些假设**，确认这些假设是否符合实际情况
2. **重现系统中的某些异常行为**，以解决这些异常
3. **测试系统当前的运行情况。**如果不清楚系统当前的性能，就无法确认某些优化的效果如何。也可以利用历史的基准测试结果来分析诊断一些无法预测的问题
4. **模拟比当前系统更高的负载**，以找出系统随着压力增加而可能遇到的扩展性瓶颈
5. **规划未来的业务增长。基准测试可以评估在项目未来的负载下，需要什么的硬件，需要多大容量的网络，以及其他相关资源。**
6. **测试应用适应可变环境的能力。**例如，通过基准测试，可以发现系统在随机地并发峰值下的性能表现，或者是不同配置的服务器之间的性能表现。基准测试也可以测试系统对不同数据分布的处理能力。

7. **测试不同硬件，软件和操作系统配置**。
8. **证明新采购的设备是否配置正确。**永远不要相信主机提供商或者硬件供应商的所谓系统已经安装好，并且能够运行多快的说法。一定要自己测试。
9. 还有其他用处，比如为应用创建单元测试套件。。。



​	基准测试的一个主要问题是并不是真实的压力测试。**基准测试施加给系统的压力相对于真实压力来说，通常比较简单**。真实压力是不可预期而且变化不定的，有时过于复杂难以理解，很难得到正确的结果。

​	**基准测试的压力和真实压力有哪些不同**？有喝多因素会影响基准测试，比如**数据量，数据和查询分布，但最重要的一点还是基准测试通常要求尽可能快的执行完成**，所以经常给系统造成过大的压力。在很多案例中，我们都会调整给测试工具最大压力，以**在系统可以容忍的压力阈值内尽可能快的执行测试**，这对于确定系统的最大容量非常有帮助，**然而大部分压力测试工具不支持对压力进行复杂的控制**。务必记住，**测试工具自身的局限也会影响到结果的有效性**。

​	使用基准测试进行容量规划也要掌握技巧，不能只根据测试结果做简单的推断。例如：假设想知道使用新数据库服务后，系统能够支撑多大的业务增长。首先对原系统进行基准测试，然后对新系统做测试，结果发现新系统可以支持原系统的40倍TPS（每秒事务数），这时候就不能简单地推断说新系统一定可以支持40倍的业务增长，它们不可能有40倍的支撑能力，尤其是相互关机





















